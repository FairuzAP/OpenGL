from glumpy import app, gloo, gl
from math import cos, sin, radians
import triangle
import numpy as np

vertex = """
  
  uniform mat4 u_trans;         // Translation/Scaling/Rotate matrix
  uniform vec4 v_color;
  attribute vec2 position;
  
  void main()
  {
    gl_Position = u_trans * vec4(position, 0.0, 1.0);
  } """

fragment = """
  uniform vec4 v_color;
  void main()
  {
      gl_FragColor = v_color;
  } """

def transMatrix(scale, dx, dy, rot):
	cosr = cos(radians(rot))
	sinr = sin(radians(rot))
	mScale = np.matrix([[scale,0,0,0],[0,scale,0,0],[0,0,scale,0],[0,0,0,1]])
	mTrans = np.matrix([[1,0,0,0],[0,1,0,0],[0,0,1,0],[dx,dy,0,1]])
	mRotat = np.matrix([[cosr,-sinr,0,0],[sinr,cosr,0,0],[0,0,1,0],[0,0,0,1]])
	return mTrans * mRotat * mScale


# Upload data into GPU
listHead = [[-1.015,36.871], [3.979,37.855], [5.539,34.606], [10.711,31.199], [12.241,30.883], [13.337,32.007], [11.813,33.732], [9.101,39.207], [8.528,42.404], [8.809,45.242],
			[9.445,48.649], [7.747,53.191], [8.141,55.137], [8.268,57.48], [7.611,56.837], [7.561,49.884], [8.467,47.643], [7.784,46.787], [6.189,43.444], [5.284,46.047],
			[5.539,49.162], [3.437,50.96], [0.068,57.598], [-0.959,58.65], [-0.176,55.794], [0.686,53.017], [3.46,48.382], [3.07,43.963], [-5.286,41.142]]

listBody = [[-5.286,41.142], [-11.16,35.709], [-12.444,32.444], [-13.436,24.339], [-9.244,-2.792], [-5.077,-9.932], [1.213,-18.718], [3.608,-21.781], [7.646,-27.231], 
			[11.907,-38.046], [10.351,-45.197], [4.812,-51.485], [2.335,-52.907], [-3.949,-54.551], [-11.409,-52.394], [-12.234,-51.789], [-13.696,-50.393], [-15.43,-47.837], 
			[-16.685,-42.984], [-12.485,-36.397], [-10.187,-34.276], [-16.389,-37.302], [-18.765,-44.934], [-13.938,-54.534], [-9.316,-57.06], [-3.299,-58.32], [-0.671,-58.32], 
			[3.156,-57.627], [15.053,-48.6], [17.513,-43.132], [18.796,-35.056], [11.829,-16.029], [7.61,-9.851], [6.319,-5.944], [8.268,22.519], [7.13,23.98], [-0.849,29.388], 
			[-3.039,32.656], [-1.015,36.871]]

listLeft = [[-13.436,24.339],[-15.981,25.823],[-23.358,34.822],[-24.564,37.774],[-25.913,44.613],[-24.018,51.426],[-20.826,54.863],[-19.675,55.921],[-26.173,56.31],[-48.739,51.973],[-49.752,51.557],[-56.82,48.098],[-58.69,46.978],[-63.963,43.284],[-67.923,39.835],[-70.263,37.627],[-73.062,34.447],[-76.965,29.383],[-83.488,17.97],[-73.221,15.111],[-72.3,11.613],[-71.549,7.945],[-69.484,-3.247],[-68.282,-6.593],[-65.458,-0.45],[-62.693,0.685],[-51.416,-9.353],[-48.454,-13.018],[-44.07,-17.992],[-40.989,-20.37],[-41.9,-18.942],[-47.439,-7.325],[-50.737,9.003],[-45.33,8.95],[-32.972,-2.085],[-32.151,-3.084],[-27.473,2.764],[-24.483,3.414],[-17.552,-0.572],[-16.425,-3.214],[-9.244,-2.792]]

listRight = [[6.319,-5.943],[8.17,-3.246],[11.258,-1.785],[15.807,-0.3214],[18.501,1.369],[20.705,2.804],[23.735,3.414],[26.671,2.842],[30.469,-0.509],[31.533,-3.084],[31.974,-2.746],[32.305,-2.167],[33.014,-1.057],[42.016,7.877],[44.512,8.89],[47.648,9.393],[50.118,9.003],[45.532,-10.715],[44.011,-14.133],[40.37,-20.37],[43.379,-18.05],[45.925,-15.267],[53.724,-5.781],[55.609,-3.636],[62.075,0.685],[64.774,-0.385],[67.663,-6.593],[70.229,4.097],[72.562,15.021],[74.322,17.68],[77.541,19.01],[80.838,18.669],[82.869,17.97],[76.347,29.38],[71.074,36.067],[67.372,39.773],[64.211,42.591],[54.277,49.163],[49.225,51.519],[45.944,52.786],[25.554,56.311],[19.056,55.921],[19.267,55.612],[23.347,51.504],[25.294,44.744],[20.041,30.372],[18.437,28.466],[17.791,27.813],[17.145,27.289],[11.128,23.429],[8.268,22.519]]

# Build the program and corresponding buffers
head = gloo.Program(vertex, fragment, count=len(listHead))
body = gloo.Program(vertex, fragment, count=len(listBody))
left = gloo.Program(vertex, fragment, count=len(listLeft))
right = gloo.Program(vertex, fragment, count=len(listRight))

head['v_color'] = (1,1,1,1)
head['position'] = listHead
head['u_trans'] = transMatrix(1/100,0,0,0)

body['v_color'] = (1,1,1,1)
body['position'] = listBody
body['u_trans'] = transMatrix(1/100,0,0,0)

left['v_color'] = (1,1,1,1)
left['position'] = listLeft
left['u_trans'] = transMatrix(1/100,0,0,0)

right['v_color'] = (1,1,1,1)
right['position'] = listRight
right['u_trans'] = transMatrix(1/100,0,0,0)

# Create a window with a valid GL context
window = app.Window()

# Tell glumpy what needs to be done at each redraw
@window.event
def on_draw(dt):
    window.clear()
    head.draw(gl.GL_LINE_STRIP)
    body.draw(gl.GL_LINE_STRIP)
    left.draw(gl.GL_LINE_LOOP)
    right.draw(gl.GL_LINE_LOOP)


# Run the app
app.run()

